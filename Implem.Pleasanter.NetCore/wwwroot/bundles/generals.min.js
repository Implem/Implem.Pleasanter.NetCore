var $p={data:{},events:{},ex:{}};$p.ajax=function(n,t,i,r,u){var e,f;return $p.before_send($p.eventArgs(n,t,i,r,u))===!1?!1:r&&(e=r.attr("data-confirm"),e!==undefined&&!confirm($p.display(e)))?!1:($p.loading(r),f=0,u=u!==undefined?u:!0,$p.clearMessage(),$.ajax({url:n,type:t,async:u,cache:!1,data:i,dataType:"json"}).done(function(e){$p.setByJson(n,t,i,r,u,e);f=e.filter(function(n){return n.Method==="Message"&&JSON.parse(n.Value).Css==="alert-error"}).length!==0?-1:0}).fail(function(n,t){alert(t+"\n"+$(n.responseText).text().trim().replace("\n",""));f=-1}).always(function(){$p.clearData("ControlId",i);$p.loaded()}),$p.after_send($p.eventArgs(n,t,i,r,u,f)),f)};$p.multiUpload=function(n,t,i,r){$p.loading(i);$p.clearMessage();var u="POST",f=$.ajax({xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){var t=0,i=n.loaded||n.position,u=n.total;n.lengthComputable&&(t=Math.ceil(i/u*100));r!==undefined&&r.setProgress(t)},!1),n},url:n,type:u,contentType:!1,processData:!1,cache:!1,data:t,success:function(){r!==undefined&&r.setProgress(100)}}).done(function(r){return $p.setByJson(n,u,t,i,!0,JSON.parse(r)),!0}).fail(function(n,t){return alert(t+"\n"+$(n.responseText).text().trim().replace("\n","")),!1}).always(function(){$p.clearData("ControlId",t);$p.loaded();r!==undefined&&r.status.hide()});r!==undefined&&r.setAbort(f)};$p.apiUrl=function(n,t){return $("#ApplicationPath").val()+"api/items/"+n+"/"+t};$p.apiGet=function(n){$p.apiExec($p.apiUrl(n.id,"get"),n)};$p.apiCreate=function(n){$p.apiExec($p.apiUrl(n.id,"create"),n)};$p.apiUpdate=function(n){$p.apiExec($p.apiUrl(n.id,"update"),n)};$p.apiDelete=function(n){$p.apiExec($p.apiUrl(n.id,"delete"),n)};$p.apiExec=function(n,t){$.ajax({url:n,type:"post",cache:!1,data:JSON.stringify(t.data),contentType:"application/json",dataType:"json"}).done(t.done).fail(t.fail).always(t.always)};$p.apiUsersUrl=function(n,t){switch(n){case"get":case"create":return $("#ApplicationPath").val()+"api/users/"+n;case"update":case"delete":return $("#ApplicationPath").val()+"api/users/"+t+"/"+n}};$p.apiUsersGet=function(n){$p.apiExec($p.apiUsersUrl("get"),n)};$p.apiUsersCreate=function(n){$p.apiExec($p.apiUsersUrl("create"),n)};$p.apiUsersUpdate=function(n){$p.apiExec($p.apiUsersUrl("update",n.id),n)};$p.apiUsersDelete=function(n){$p.apiExec($p.apiUsersUrl("delete",n.id),n)};$p.getData=function(n){return formId=$p.getFormId(n),formId in $p.data||($p.data[formId]={}),$p.data[formId]};$p.set=function(n,t){if(n.length===1){switch(n.prop("type")){case"checkbox":n.prop("checked",t);break;case"textarea":n.val(t);$p.showMarkDownViewer(n);break;default:switch(n.prop("tagName")){case"SELECT":n.val(t);n.change();break;default:n.val(t)}}$p.setData(n)}};$p.setData=function(n,t){var i=n.attr("id");if(!n.hasClass("not-send")){t===undefined&&(t=$p.getData(n));$p.setGridTimestamp(n,t);switch(n.prop("type")){case"checkbox":t[i]=n.prop("checked");break;case"radio":n.prop("checked")&&(t[n.attr("name")]=n.val());break;default:switch(n.prop("tagName")){case"SPAN":t[i]=n.attr("data-value")!==undefined?n.attr("data-value"):n.text();break;case"SELECT":n.attr("multiple")?$p.setMultiSelectData(n):t[i]=n.val();break;case"OL":n.hasClass("control-selectable")?(t[i]=$p.toJson(n.find("li.ui-selected")),n.hasClass("send-all")&&(t[i+"All"]=$p.toJson(n.find("li")))):t[i]=$p.toJson(n.find("li"));break;case"TABLE":t[i]=JSON.stringify(n.find(".select").filter(":checked").map(function(){return $(this).closest(".grid-row").attr("data-id")}).toArray());break;case"P":t[i]=n.hasClass("control-slider")?n.attr("data-value"):n.val();break;default:t[i]=n.val()}}}};$p.setGridTimestamp=function(n,t){var i=n.closest(".grid-row").find(".timestamp");i.length===1&&(t[i.attr("id")]=i.val())};$p.setAndSend=function(n,t){$p.setData($(n));$p.send(t)};$p.setMustData=function(n,t){t!==undefined&&t.toLowerCase()==="create"?n.find('[class*="control-"]').each(function(){$p.setData($(this))}):n.find('.always-send,[data-always-send="1"]').each(function(){$p.setData($(this))})};$p.clearData=function(n,t,i){if(t||(t=$p.getData($(".main-form"))),n===undefined)for(controlId in t)$("#"+controlId).hasClass("control-selectable")||delete t[controlId];else if(i==="startsWith")for(controlId in t)controlId.indexOf(n)===0&&delete t[controlId];else n in t?delete t[n]:$(n).length!==0&&delete t[$(n).attr("id")]};$p.toJson=function(n){return JSON.stringify(n.map(function(){return $(this).attr("data-value")===undefined?$(this).text():$(this).attr("data-value")}).toArray())};$p.setByJson=function(n,t,i,r,u,f){$p.before_set($p.eventArgs(n,t,i,r,u,undefined,f));f&&$.each(f,function(){$p.setByJsonElement(this,i,r)});f.filter(function(n){return n.Method==="Html"||n.Method==="ReplaceAll"||n.Method==="Append"||n.Method==="Prepend"||n.Method==="After"||n.Method==="Before"}).length>0&&($p.apply(),$p.applyValidator());$p.after_set($p.eventArgs(n,t,i,r,u,undefined,f))};$p.setByJsonElement=function(n,t,i){var e=n.Method,r=n.Target,u=n.Value,f;switch(e){case"Html":$(r).html(u);break;case"ReplaceAll":$(u).replaceAll(r);break;case"Message":$p.setMessage(r,u);break;case"Href":location.href=u;break;case"PushState":history.pushState(r,"",u);break;case"SetData":$p.setData($(r));break;case"SetFormData":t[r]=u;break;case"SetMemory":$p[r]=u;break;case"Append":$(r).append(u);break;case"Prepend":$(r).prepend(u);break;case"After":$(r).length!==0?$(r).after(u):i.after(u);break;case"Before":$(r).length!==0?$(r).before(u):i.before(u);break;case"InsertText":$p.insertText($(r),u);break;case"Remove":$(r).remove();break;case"Attr":f=JSON.parse(u);$(r).attr(f.Name,f.Value);break;case"RemoveAttr":$(r).removeAttr(u);break;case"Focus":r===""?$("#"+t.ControlId).focus():$(r).focus();break;case"SetValue":$p.setValue($(r),u);break;case"ClearFormData":$p.clearData(r,t,u);break;case"CloseDialog":$p.clearMessage();r!==undefined?$(r).dialog("close"):$(".ui-dialog-content").dialog("close");break;case"Paging":$p.paging(r);break;case"Toggle":$(r).toggle(u==="1");break;case"Trigger":$(r).trigger(u);break;case"Invoke":$p[r]();break;case"Events":$p.execEvents(r,"");break;case"WindowScrollTop":$(window).scrollTop(u);break;case"ScrollTop":$(r).scrollTop(u);break;case"LoadScroll":$p.loadScroll();break;case"FocusMainForm":$p.focusMainForm();break;case"Disabled":$(r).prop("disabled",u)}};$p.eventArgs=function(n,t,i,r,u,f,e){var o={};return o.url=n,o.methodType=t,o.data=i,o.$control=r,o.async=u,o.ret=f,o.json=e,o};$p.execEvents=function(n,t){function r(n){if($p.events[n]!==undefined)return $p.events[n](t)===!1?!1:!0}var i=r(n);return t.$control&&(i=r(n+"_"+t.$control.attr("id"))&&i,i=r(n+"_"+t.$control.attr("data-action"))&&i),i};$p.before_validate=function(n){return $p.execEvents("before_validate",n)};$p.after_validate=function(n){return $p.execEvents("after_validate",n)};$p.before_send=function(n){return $p.execEvents("before_send",n)};$p.after_send=function(n){$p.execEvents("after_send",n)};$p.before_set=function(n){$p.execEvents("before_set",n)};$p.after_set=function(n){$p.execEvents("after_set",n)};$p.getFormId=function(n){return n.closest("form").attr("id")};$p.clear=function(n){var t=n.attr("id"),i=$p.getData(n);switch(n.prop("tagName")){case"INPUT":switch(n.prop("type")){case"checkbox":n.prop("checked",!1);break;case"text":n.val("")}break;case"SELECT":n.attr("multiple")?n.addClass("no-postback").multiselect("uncheckAll").removeClass("no-postback"):n.val("")}$p.clearData(t,i)};$p.outsideDialog=function(n){var t=$(".ui-dialog:visible").map(function(n,t){return $("#"+t.getAttribute("aria-describedby"))});return t.length!==0&&t.filter(function(t,i){return n.closest(i).length===1}).length===0};$p.syncSend=function(n,t){return $p.send(n,t,!1)};$p.send=function(n,t,i){if($p.outsideDialog(n))return!1;$form=t!==undefined?$("#"+t):n.closest("form");var f=n.attr("data-action"),r=n.attr("data-method"),u=$p.getData($form),e=f!==undefined?$form.attr("action").replace("_action_",f.toLowerCase()):location.href;if(i=i!==undefined?i:!0,r!=="get"&&(u.ControlId=n.attr("id"),$p.setMustData($form,f)),n.hasClass("validate")){if($p.before_validate($p.eventArgs(e,r,u,n,i))===!1)return!1;if($form.validate(),!$form.valid())return $p.setValidationError($form),$p.setErrorMessage("ValidationError"),n.closest(".ui-dialog")||$("html,body").animate({scrollTop:$(".error:first").offset().top}),!1;if($p.after_validate($p.eventArgs(e,r,u,n,i))===!1)return!1}if(r!==undefined)return $p.ajax(e,r,r!=="get"?u:null,n,i)};$p.setFormChanged=function(n){n.hasClass("not-set-form-changed")||($p.formChanged=!0)};$p.dateAdd=function(n,t,i){switch(n){case"d":return new Date(new Date(i).setDate(i.getDate()+t))}};$p.dateDiff=function(n,t,i){switch(n){case"d":return parseInt((t-i)/864e5)}};$p.shortDate=function(n){return n===undefined&&(n=new Date),new Date($p.shortDateString(n))};$p.beginningMonth=function(n){return n===undefined&&(n=new Date),new Date(n.getFullYear()+"/"+(n.getMonth()+1)+"/1")};$p.shortDateString=function(n){return n===undefined&&(n=new Date),n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()};$p.dateTimeString=function(n){return n===undefined&&(n=new Date),$p.shortDateString(n)+(n.getHours()+n.getMinutes()!==0?" "+n.getHours()+":"+n.getMinutes():"")};$p.setValue=function(n,t){switch(n.prop("type")){case"checkbox":n.prop("checked",t);break;case"radio":n.val([t]);break;default:switch(n.prop("tagName")){case"SPAN":n.html(t);case"TIME":n.html(t);n.attr("datetime",t);break;default:n.val(t)}}};$(function(){$(document).on("change",'[class^="control-"]:not(select[multiple])',function(n){var t=$(this);t.hasClass("control-spinner")&&(t.val()===""&&t.hasClass("allow-blank")?t.val(""):t.val()===""||t.val().match(/[^0-9\.]/g)||parseInt(t.val())<parseInt(t.attr("data-min"))?t.val(t.attr("data-min")):parseInt(t.val())>parseInt(t.attr("data-max"))&&t.val(t.attr("data-max")),$p.setFormChanged(t));$p.setData(t);n.preventDefault()});$(document).on("spin",".control-spinner",function(n,t){var i=$(this),r=$p.getData(i);r[this.id]=t.value;$p.setGridTimestamp(i,r);$p.setFormChanged(i)});$(document).on("change",".control-checkbox.visible",function(){function n(n,t){t?$(n).show():$(n).hide()}n(this.id.substring(7,this.id.length),$(this).prop("checked"))});$(document).on("change",'.auto-postback:not([type="text"],select[multiple])',function(){$p.send($(this))});$(document).on("change",".datepicker.auto-postback",function(){$p.send($(this))});$(document).on("keyup",'.auto-postback[type="text"]',function(n){var t=$(this);$p.setData(t);n.keyCode===13&&($p.send(t),delete $p.getData(t)[t.attr("id")])})});$(function(){$(document).on("change","#AggregationType",function(){$(this).val()==="Count"?$("#AggregationTarget").closest(".togglable").hide():$("#AggregationTarget").closest(".togglable").show()});$(document).on("click","#Aggregations .data.link",function(){var n=$($(this).attr("data-selector")),t;n.length===1&&(t=$(this).attr("data-value"),n.multiselect("widget").find(":checkbox").each(function(){if($(this).val()===t){$(this).click();return}}))});$(document).on("click","#Aggregations .overdue",function(){$("#ViewFilters_Overdue").click()})});$(function(){$(document).on("click","a",function(n){n.stopPropagation()})});$p.uploadAttachments=function(n,t){function h(n,t,i){this.progressBar=t;this.abort=i;this.status=n;this.setProgress=function(n){var t=n*this.progressBar.width()/100;this.progressBar.find("div").animate({width:t},10)};this.setAbort=function(n){var t=this.status;this.abort.click(function(){n.abort();t.hide()})}}for(var f,o,r=n.attr("data-name"),e=n.parent().find(".control-attachments").attr("id"),s=$(".main-form").attr("action").replace("_action_",n.attr("data-action")),i=new FormData,u=0;u<t.length;u++)i.append("file",t[u]);i.append("ControlId",e);i.append("ColumnName",r);i.append("AttachmentsData",$("#"+e).val());f=$('[id="'+r+'.status"]');o=new h(f,$('[id="'+r+'.progress"]'),$('[id="'+r+'.abort"]'));f.show();$p.multiUpload(s,i,n,o)};$p.deleteAttachment=function(n,t){var i=JSON.parse(n.val());i.filter(function(n,i,r){if(n.Added===!0){if(n.Guid.toString()===t.attr("data-id")){var u={};u.Guid=n.Guid;url=$(".main-form").attr("action").replace("_action_",t.attr("data-action"));$p.ajax(url,"post",u);$("#"+n.Guid).remove();r.splice(i,1)}}else n.Guid===t.attr("data-id")&&(n.Deleted?(n.Deleted=!1,t.parent().removeClass("preparation-delete"),t.removeClass("ui-icon-trash"),t.addClass("ui-icon-circle-close")):(n.Deleted=!0,t.parent().addClass("preparation-delete"),t.removeClass("ui-icon-circle-close"),t.addClass("ui-icon-trash")))});i=JSON.stringify(i);n.val(i);$p.setData(n)};$(document).on("dragenter",".control-attachments-upload",function(n){n.stopPropagation();n.preventDefault()});$(document).on("dragover",".control-attachments-upload",function(n){n.stopPropagation();n.preventDefault();$(this).css("border","2px solid #d19405")});$(document).on("drop",".control-attachments-upload",function(n){var t=$(this),i;t.css("border","2px dotted #d19405");n.preventDefault();i=n.originalEvent.dataTransfer.files;$p.uploadAttachments(t,i)});$(document).on("click",".control-attachments-upload",function(){var n=$(this),t=document.getElementById(n.attr("data-name")+".input");t.click()});$(document).on("change",".control-attachments-upload",function(){var n=$(this),t=document.getElementById(n.attr("data-name")+".input");t.files.length!=0&&$p.uploadAttachments(n,t.files)});$(document).on("dragenter",function(n){n.stopPropagation();n.preventDefault()});$(document).on("dragover",function(n){n.stopPropagation();n.preventDefault();$(this).css("border","2px solid #d19405")});$(document).on("drop",function(n){n.stopPropagation();n.preventDefault()});$p.addBasket=function(n,t,i){var r=$("<li/>");i!==undefined&&r.attr("data-value",i);r.addClass("ui-widget-content ui-selectee").append($("<span/>").text(t)).append($("<span/>").addClass("ui-icon ui-icon-close delete"));n.append(r);$p.setData(n)};$(function(){$(document).on("click",".control-basket > li > .delete",function(){var n=$(this).closest("ol");$(this).parent().remove();$p.setData(n)})});$p.drawBurnDown=function(){function o(t,u,o){function s(n){switch(u){case 0:return n.Total;case 1:return n.Planned;case 2:return n.Earned}}var c=d3.svg.line().x(function(t){return $p.dateDiff("d",new Date(t.Day),e)*l+n+i}).y(function(n){return f(s(n))}),h=r.append("g").attr("class",t);h.append("path").attr("d",c(o));h.selectAll("circle").data(o).enter().append("circle").attr("cx",function(t,r){return r*l+n+i}).attr("cy",function(n){return f(s(n))}).attr("r",4).append("title").text(function(n){return s(n)})}var u=$("#BurnDown"),t;if(u.length===1){if(u.empty(),t=JSON.parse($("#BurnDownJson").val()),t.length===0){u.hide();return}u.show();var r=d3.select("#BurnDown"),i=40,n=70,y=parseInt(r.style("width")),s=parseInt(r.style("height")),h=y-n-i,p=s-n-i,e=new Date(d3.min(t,function(n){return n.Day})),c=new Date(d3.max(t,function(n){return n.Day})),l=(h-i)/$p.dateDiff("d",c,e),a=d3.time.scale().domain([e,c]).range([i,h]),f=d3.scale.linear().domain([d3.max(t,function(n){return n.Total!==undefined||n.Earned!==undefined?Math.max.apply(null,[n.Total,n.Planned,n.Earned]):n.Planned}),0]).range([i,p]).nice(),w=d3.svg.axis().scale(a).tickFormat(d3.time.format("%m/%d")).ticks(10),b=d3.svg.axis().scale(f).orient("left");r.append("g").attr("class","axis").attr("transform","translate("+n+", "+(s-n)+")").call(w).selectAll("text").attr("x",-20).attr("y",20).style("text-anchor","start");r.append("g").attr("class","axis").attr("transform","translate("+n+", 0)").call(b).selectAll("text").attr("x",-20);var v=n+a(new $p.shortDate),k=[[v,n-40],[v,f(0)+20]],d=d3.svg.line().x(function(n){return n[0]}).y(function(n){return n[1]});r.append("g").attr("class","now").append("path").attr("d",d(k));o("total",0,t.filter(function(n){return n.Total!==undefined}));o("planned",1,t.filter(function(n){return n.Planned!==undefined}));o("earned",2,t.filter(function(n){return n.Earned!==undefined}))}};$(function(){$(document).on("click","#BurnDownDetails > tbody > tr",function(){var n=$(this),t;n.next().hasClass("items")?n.next().remove():(t=$p.getData(n),t.BurnDownDate=n.attr("data-date"),t.BurnDownColspan=n.find("td").length,$p.send(n))});$(document).on("click","#BurnDownDetails .items",function(){$(this).remove()})});$p.moveCalendar=function(n){var t=$("#CalendarMonth");t.val($("#Calendar"+n).val());$p.setData(t);$p.send(t)};$p.setCalendar=function(){function o(i,r,u,f){i.forEach(function(i){var e=$p.beginningMonth(new Date(i.From)),o;if(e<u&&(e=new Date(u)),rank=n(r,$p.shortDateString(e)),t(r,i,e,undefined,undefined,1),i.To!==undefined)for(e.setMonth(e.getMonth()+1),o=new Date(i.To),o>f&&(o=f);$p.shortDate(o)>=$p.shortDate(e);)t(r,i,e,1,rank),e.setMonth(e.getMonth()+1)})}function s(i,r,u,f){i.forEach(function(i){var e=new Date(i.From),o;if(e<u&&(e=new Date(u)),rank=n(r,$p.shortDateString(e)),t(r,i,e),i.To!==undefined)for(e.setDate(e.getDate()+1),o=new Date(i.To),o>f&&(o=f);$p.shortDate(o)>=$p.shortDate(e);)e.getDay()===1&&(rank=n(r,$p.shortDateString(e))),t(r,i,e,e.getDay()!==1,rank),e.setDate(e.getDate()+1)});$("#CalendarCanUpdate").val()==="1"&&($("#Calendar .item").draggable({revert:"invalid",start:function(){$(this).parent().droppable({disabled:!0})},helper:function(){return $("<div />").addClass("dragging").append($("<div />").append($(this).text()))}}),$("#Calendar .container").droppable({hoverClass:"hover",tolerance:"intersect",drop:function(n,t){var i=$(t.draggable),u=new Date(i.attr("data-from")),f=new Date($(this).attr("data-id")),r=$p.getData($(".main-form")),o=$("#CalendarFromTo").val().split("-"),s=$("#TableName").val()+"_",h,c;r.Id=i.attr("data-id");r[s+o[0]]=e(f,u);i.attr("data-to")!==undefined&&(h=$p.dateDiff("d",f,$p.shortDate(u)),c=$p.dateAdd("d",h,new Date(i.attr("data-to"))),r[s+o[1]]=e(c));$p.saveScroll();$p.send($("#CalendarBody"))}}))}function n(n,t){return n[t]===undefined&&(n[t]=0),n[t]}function t(t,i,r,u,f,e){for(var o=$p.shortDateString(r),h=$('[data-id="'+o+'"] > div'),s;n(t,o)<f;)h.append($("<div />").addClass("dummy")),t[o]++;s=$("<div />").addClass("item").addClass(i.Changed===!0?"changed":"").attr("data-id",i.Id).attr("data-from",i.From).attr("data-to",i.To);u&&s.append($("<div />").attr("data-id",i.Id).addClass("connection").addClass(i.Changed===!0?"changed":""));s.append($("<div />").addClass("title").css("width",function(){var f=h.parent().width(),o=16,t,n,s;if(u)return"";if(i.To===undefined)return f-o;if(e){for(n=0,t=new Date(r),t.setMonth(t.getMonth()+1);t<=new Date(i.To);)n++,t.setMonth(t.getMonth()+1);return f*(n+1)-o}return n=$p.dateDiff("d",$p.shortDate(new Date(i.To)),$p.shortDate(r)),s=r.getDay()!==0?r.getDay():7,s+n>6?n=7-s:n<0&&(n=0),f*(n+1)-o}).addClass(u?"sub":"").attr("title",i.Title+" -- "+$p.dateTimeString(new Date(i.From))+(i.To!==undefined&&i.To!==i.From?" - "+$p.dateTimeString(new Date(i.To)):"")).append($("<span />").addClass("ui-icon ui-icon-pencil")).append((i.Time!==undefined?i.Time+" ":"")+i.Title));h.append(s);t[o]++}function e(n,t){return t===undefined&&(t=n),n.getFullYear()+"/"+(n.getMonth()+1)+"/"+n.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds()}$("#Calendar .container > div > div:not(.day)").remove();var i=JSON.parse($("#CalendarJson").val()),r={},u=new Date($("#Calendar .container:first").attr("data-id")),f=new Date($("#Calendar .container:last").attr("data-id"));switch($("#CalendarTimePeriod").val()){case"Yearly":o(i,r,u,f);break;case"Monthly":s(i,r,u,f)}};$(function(){$(document).on("dblclick","#Calendar .item",function(){location.href=$("#BaseUrl").val()+$(this).attr("data-id")});$(document).on("click","#Calendar .item .ui-icon-pencil",function(){location.href=$("#BaseUrl").val()+$(this).parent().parent().attr("data-id")});$(document).on("mouseenter","#Calendar .item",function(){$('[data-id="'+$(this).attr("data-id")+'"]').addClass("hover")});$(document).on("mouseleave","#Calendar .item",function(){$('[data-id="'+$(this).attr("data-id")+'"]').removeClass("hover")});$(window).on("resize",function(){$("#Calendar").length===1&&setTimeout(function(){$p.saveScroll();$p.setCalendar("#Grid");$p.loadScroll()},10)});$(document).on("dblclick","#Calendar .ui-droppable",function(n){var i=function(n,t){if(t==="")return"";var i=new Date(n.getTime());return i.setDate(i.getDate()+parseInt(t,10)),i.getFullYear()+"/"+(i.getMonth()+1)+"/"+i.getDate()},r=function(n,t,i){if(t){var r=document.createElement("input");r.setAttribute("type","hidden");r.setAttribute("name",$(".main-form").attr("name").replace(/Form$/,"")+"_"+t);r.setAttribute("value",i);n.appendChild(r)}};if(!$(n.target).is(".title")){var u=new Date($(this).attr("data-id")),f=$("#CalendarFromTo").val().split("-"),t=document.createElement("form");t.setAttribute("action",$(".ui-icon-plus").parent().attr("href"));t.setAttribute("method","post");t.style.display="none";document.body.appendChild(t);r(t,f[0],i(u,$("#CalendarFromDefaultInput").val()));r(t,f[1],i(u,$("#CalendarToDefaultInput").val()));t.submit()}});$(document).on("click",".calendar-to-monthly",function(){var n={CalendarTimePeriod:"Monthly",CalendarMonth:$(this).attr("data-id")};$p.ajax(location.href,"post",n)})});$p.copyDirectUrlToClipboard=function(n){var t=$("<div>"),i=$("<pre>");t.append(i);i.text(n);t.css({position:"fixed",left:"-100%",top:"-100%"});$(document.body).append(t);document.getSelection().selectAllChildren(t.get(0));document.execCommand("copy");t.remove();alert($p.display("DirectUrlCopied"))};$p.openColumnAccessControlDialog=function(n){$p.data.ColumnAccessControlForm={};var t=$p.syncSend(n);t===0&&$("#ColumnAccessControlDialog").dialog({modal:!0,width:"900px",appendTo:"#Editor"})};$p.addColumnAccessControl=function(){$("#SourceColumnAccessControl li.ui-selected").appendTo("#CurrentColumnAccessControl");$p.setData($("#CurrentColumnAccessControl"))};$p.deleteColumnAccessControl=function(){$("#CurrentColumnAccessControl li.ui-selected").appendTo("#SourceColumnAccessControl")};$p.changeColumnAccessControl=function(n,t){$p.setData($("#"+t+"ColumnAccessControl"));var i=$p.getData(n),r=$p.getData($(".main-form"));i.ColumnAccessControl=r[t+"ColumnAccessControl"];i.ColumnAccessControlAll=r[t+"ColumnAccessControlAll"];i.ColumnAccessControlType=t;$p.send(n)};$p.confirmReload=function(){return $p.formChanged?confirm($p.display("ConfirmUnload")):!0};$(function(){$(document).on("change",".confirm-unload input, .confirm-unload select, .confirm-unload textarea",function(){$p.setFormChanged($(this))});$(window).bind("beforeunload",function(){if($p.formChanged)return $p.display("ConfirmUnload")})});$p.moveCrosstab=function(n){var t=$("#CrosstabMonth");t.val($("#Crosstab"+n).val());$p.setData(t);$p.send(t)};$p.setCrosstab=function(){$("#CrosstabColumnsField").toggle($("#CrosstabGroupByY").val()==="Columns");$("#CrosstabValueField").toggle($("#CrosstabGroupByY").val()!=="Columns"&&$("#CrosstabAggregateType").val()!=="Count");var n=$("#CrosstabXType").val()==="datetime";$("#CrosstabTimePeriodField").toggle(n);$("#CrosstabMonth").toggle(n);$("#CrosstabPreviousButton").toggle(n);$("#CrosstabNextButton").toggle(n);$("#CrosstabThisMonthButton").toggle(n)};$p.openDialog=function(n,t){$(n.attr("data-selector")).dialog({modal:!0,width:"420px",appendTo:t})};$p.closeDialog=function(n){$p.clearMessage();n.closest(".ui-dialog-content").dialog("close")};$p.clearDialogs=function(){$("body > .ui-dialog").remove()};$(function(){$(document).on("click",".ui-widget-overlay",function(){$p.clearMessage();$(".ui-dialog-content:visible").dialog("close")})});$p.display=function(n){var t={CanNotConnectCamera:"Can not connect to the camera.",CanNotConnectCamera_ja:"カメラに接続できません。",CheckAll:"Check all",CheckAll_ja:"全て選択",ConfirmCreateLink:"Would you like to create a link ?",ConfirmCreateLink_ja:"リンクを作成しますか？",ConfirmDelete:"Are you sure you want to delete ?",ConfirmDelete_ja:"本当に削除してもよろしいですか？",ConfirmPhysicalDelete:"Are you sure you want to delete ?",ConfirmPhysicalDelete_ja:"この操作を行うと元に戻すことはできません。本当に削除してもよろしいですか？",ConfirmRebuildSearchIndex:"Would you like to rebuild the search index ?",ConfirmRebuildSearchIndex_ja:"検索インデックスを再構築しますか？",ConfirmReset:"Are you sure you want to reset ?",ConfirmReset_ja:"本当にリセットしてもよろしいですか？",ConfirmRestore:"Are you sure you want to restore ?",ConfirmRestore_ja:"本当に復元してもよろしいですか？",ConfirmSendMail:"Are you sure you want to send an email ?",ConfirmSendMail_ja:"メールを送信してもよろしいですか？",ConfirmSeparate:"Are you sure you want to separate ?",ConfirmSeparate_ja:"分割してもよろしいですか？",ConfirmSwitchUser:"Are you sure you want to switch users?",ConfirmSwitchUser_ja:"本当にユーザを切り替えますか？",ConfirmSynchronize:"Are you sure you want to synchronize the data ?",ConfirmSynchronize_ja:"データを同期してもよろしいですか？",ConfirmUnload:"Are you sure you want to unload this page?",ConfirmUnload_ja:"このページを離れますか? 行った変更が保存されない可能性があります。",DirectUrlCopied:"Copied to Clipboard",DirectUrlCopied_ja:"クリップボードにコピーしました",Manager:"Manager",Manager_ja:"管理者",OrderAsc:"Asc",OrderAsc_ja:"昇順",OrderDesc:"Desc",OrderDesc_ja:"降順",OrderRelease:"Release",OrderRelease_ja:"解除",ResetOrder:"Reset",ResetOrder_ja:"リセット",UncheckAll:"Uncheck all",UncheckAll_ja:"全て解除",ValidateDate:"This is an invalid date.",ValidateDate_ja:"日付または時刻が不正です。",ValidateEmail:"Doesn’t look like a valid email.",ValidateEmail_ja:"メールアドレスの形式が不正です。",ValidateEqualTo:"Please enter the same value again.",ValidateEqualTo_ja:"入力した文字列が一致しません。",ValidateMaxLength:"Entered is too long.",ValidateMaxLength_ja:"入力した文字が長すぎます。",ValidateMaxNumber:"The number entered is too large.",ValidateMaxNumber_ja:"入力された数字が大きすぎます。",ValidateMinNumber:"The number entered is too small.",ValidateMinNumber_ja:"入力された数字が小さすぎます。",ValidateNumber:"You can not enter a non-numeric.",ValidateNumber_ja:"数値以外入力不可です。",ValidateRequired:"This information is required.",ValidateRequired_ja:"入力必須項目です。",ValidationError:"There is an error in the entered content.",ValidationError_ja:"入力された内容に誤りがあります。"},i=n+"_"+$("#Language").val();return t[i]?t[i]:t[n]?t[n]:n};$p.setDropDownSearch=function(){var n=$('[id="'+$("#DropDownSearchTarget").val()+'"]');n.attr("multiple")==="multiple"&&n.multiselect("refresh");$p.setData(n);n.hasClass("auto-postback")&&$p.send(n);n.val()!==""&&n.hasClass("error")&&(n.removeClass("error"),$('[id="'+n.attr("id")+'-error"]').remove())};$p.openDropDownSearchDialog=function(n){var t=n.attr("id"),i=$("#DropDownSearchText"),r=$("#DropDownSearchTarget");$("#DropDownSearchParentClass").val($("#"+t).attr("parent-data-class"));$("#DropDownSearchParentDataId").val($("#"+t).attr("parent-data-id"));$("#DropDownSearchResults").empty();r.val(t);i.val("");$("#DropDownSearchMultiple").val(n.attr("multiple")==="multiple");$($("#DropDownSearchDialog")).dialog({title:$('label[for="'+t+'"]').text(),modal:!0,width:"630px",close:function(){$("#"+r.val()).prop("disabled",!1)}});$p.send(i);$p.setPaging("DropDownSearchResults");n.prop("disabled",!0);i.focus()};$(function(){$(document).on("focusin",".control-dropdown.search",function(){$("#EditorLoading").val()==="1"?($(this).blur(),$("#EditorLoading").val(0)):$p.openDropDownSearchDialog($(this))})});$p.openExportSelectorDialog=function(n){error=$p.send(n);error===0&&$("#ExportSelectorDialog").dialog({modal:!0,width:"420px"})};$p.export=function(){var n=$p.getData($(".main-form"));location.href=$(".main-form").attr("action").replace("_action_","export")+"?id="+$("#ExportId").val()+"&GridCheckAll="+n.GridCheckAll+"&GridUnCheckedItems="+n.GridUnCheckedItems+"&GridCheckedItems="+n.GridCheckedItems;$p.closeDialog($("#ExportSelectorDialog"))};$p.exportCrosstab=function(){location.href=$(".main-form").attr("action").replace("_action_","exportcrosstab")};$(function(){$(document).on("click","#ViewFilters_Reset",function(){$('[id^="ViewFilters_"]').each(function(){$p.clear($(this))});$p.send($(this))})});$p.focusMainForm=function(){$("#FieldSetGeneral").find('[class^="control-"]').each(function(){if(!$(this).is(":hidden")&&!$(this).hasClass("control-text")&&!$(this).hasClass("control-markup"))return $(this).focus(),!1})};$(function(){var n=$(".control-textbox.focus");n.length!==0&&setTimeout(function(){n.focus()},0)});$p.moveGantt=function(n){var t=$("#GanttStartDate"),i=$("#Gantt"+n).val();t.val(i);t.attr("data-previous",i);$p.getData(t).GanttStartDate=i;$p.send(t)};$p.drawGantt=function(){function k(n,i){var u=[[n,t-10],[n,t+d3.max(r,function(n){return n.Y})+10]],e=d3.svg.line().x(function(n){return n[0]}).y(function(n){return n[1]});f.append("g").attr("class",i).append("path").attr("d",e(u))}var h=$("#Gantt"),d=$("#GanttAxis"),r,l,s,i,w,b,a,v;if(h.length===1){if(h.empty(),d.empty(),r=JSON.parse($("#GanttJson").val()),r.length===0){h.hide();return}h.show();var g=new Date,c=d3.select("#GanttAxis"),f=d3.select("#Gantt"),t=20,nt=parseInt(f.style("width")),e=new Date($("#GanttMinDate").val()),o=new Date($("#GanttMaxDate").val()),n=d3.time.scale().domain([e,o]).range([0,nt-60]),tt=n(o)/2,y=[],p,u=[];for(l=0;l<$p.dateDiff("d",o,e);l++)s=$p.dateAdd("d",l,e),u.push(s),p!==s.getMonth()&&(p=s.getMonth(),y.push(s));for(c.append("g").selectAll("rect").data(u).enter().append("rect").attr("x",function(t){return 30+n(t)}).attr("y",25).attr("width",n(u[1])).attr("height",20).attr("class",function(n){switch(n.getDay()){case 0:return"sunday";case 6:return"saturday";default:return"weekday"}}),i=e;i<=o;)w=[[30+n(i),25],[30+n(i),45]],b=d3.svg.line().x(function(n){return n[0]}).y(function(n){return n[1]}),c.append("g").attr("class","date").append("path").attr("d",b(w)),i=$p.dateAdd("d",1,i);for(c.append("g").attr("class","title").selectAll("text").data(y).enter().append("text").attr("text-anchor","middle").attr("x",function(t){return 30+n(t)+(n($p.dateAdd("d",1,t))-n(t))/2}).attr("y",20).text(function(n){return n.getMonth()+1}),c.append("g").attr("class","title").selectAll("text").data(u.filter(function(n){return u.length<=90||[5,10,15,20,25,30].indexOf(n.getDate())>-1})).enter().append("text").attr("text-anchor","middle").attr("x",function(t){return 30+n(t)+(n($p.dateAdd("d",1,t))-n(t))/2}).attr("y",40).text(function(n){return n.getDate()}),a=t+n(g),v=r.filter(function(n){return n.GroupSummary}).length===0?0:-1,$.each(r,function(n,i){i.GroupSummary&&v++;i.Y=t+n*25+v*25}),$("#Gantt").css("height",d3.max(r,function(n){return n.Y})+45),f.append("g").selectAll("rect").data(u.filter(function(n){switch(n.getDay()){case 0:return!0;case 6:return!0;default:return!1}})).enter().append("rect").attr("x",function(i){return t+n(i)}).attr("y",t-10).attr("width",n(u[1])).attr("height",t+d3.max(r,function(n){return n.Y})).attr("class",function(n){switch(n.getDay()){case 0:return"sunday";case 6:return"saturday";default:return null}}),i=e;i<=o;)k(t+n(i),"date"),i=$p.dateAdd("d",1,i);f.append("g").attr("class","planned").selectAll("rect").data(r).enter().append("rect").attr("x",function(i){return t+n(new Date(i.StartTime))}).attr("y",function(n){return n.Y}).attr("width",function(t){return n(new Date(t.CompletionTime))-n(new Date(t.StartTime))}).attr("height",23).attr("class",function(n){var t=n.Completed?"completed":"";return n.GroupSummary?t+" summary":t}).attr("data-id",function(n){return n.Id}).append("title").text(function(n){return n.StartTime+" - "+n.DisplayCompletionTime});f.append("g").attr("class","earned").selectAll("rect").data(r).enter().append("rect").attr("x",function(i){return t+n(new Date(i.StartTime))}).attr("y",function(n){return n.Y}).attr("width",function(t){return(n(new Date(t.CompletionTime))-n(new Date(t.StartTime)))*t.ProgressRate*.01}).attr("height",23).attr("class",function(i){var r=i.ProgressRate<100&&t+n(new Date(i.StartTime))+(n(new Date(i.CompletionTime))-n(new Date(i.StartTime)))*i.ProgressRate*.01<a?"delay":i.ProgressRate===100&&i.Completed?"completed":"";return i.GroupSummary?r+" summary":r}).attr("data-id",function(n){return n.Id}).append("title").text(function(n){return n.StartTime+" - "+n.DisplayCompletionTime});k(a,"now");f.append("g").attr("class","title").selectAll("text").data(r).enter().append("text").attr("x",function(i){return n(new Date(i.StartTime))<0?t+5:t+n(new Date(i.StartTime))+5}).attr("y",function(n){return n.Y+16}).attr("width",function(t){return(n(new Date(t.CompletionTime))-n(new Date(t.StartTime)))*t.ProgressRate*.01}).attr("height",23).attr("class",function(i){var r=i.ProgressRate<100&&t+n(new Date(i.StartTime))+(n(new Date(i.CompletionTime))-n(new Date(i.StartTime)))*i.ProgressRate*.01<a&&($("#ShowGanttProgressRate").val()==="1"||!i.Completed)?"delay":"";return i.GroupSummary?r+" summary":r}).attr("text-anchor",function(){return"start"}).attr("data-id",function(n){return n.Id}).text(function(n){return n.Title}).append("title").text(function(n){return n.StartTime+" - "+n.DisplayCompletionTime+" : "+n.Title})}};$(function(){$(document).on("click","#Gantt .planned rect,#Gantt .earned rect,#Gantt .title text",function(){$(this).filter(".summary").length===0&&(location.href=$("#BaseUrl").val()+$(this).attr("data-id"))})});$p.setGrid=function(){$p.paging("#Grid")};$p.openEditorDialog=function(){$p.data.DialogEditorForm={};$("#EditorDialog").dialog({modal:!0,width:"90%",open:function(){$("#EditorLoading").val(0)}})};$p.editOnGrid=function(n,t){if(t===0&&!$p.confirmReload())return!1;$("#EditOnGrid").val(t);$p.send(n)};$p.newOnGrid=function(n){$p.send(n,"MainForm");$(window).scrollTop(0)};$p.copyRow=function(n){$p.getData(n).OriginalId=n.closest(".grid-row").attr("data-id");$p.send(n);$(window).scrollTop(0)};$p.cancelNewRow=function(n){$p.getData(n).CancelRowId=n.closest(".grid-row").attr("data-id");$p.send(n)};$(function(){if($("#Grid").length!=0){var n=n||{};n.$clone=null;n.view=0;n.StyleCopy=function(n,t){n.css("width",t.css("width"));n.css("height",t.css("height"));n.css("padding-top",t.css("padding-top"));n.css("padding-left",t.css("padding-left"));n.css("padding-bottom",t.css("padding-bottom"));n.css("padding-right",t.css("padding-right"));n.css("background",t.css("background"));n.css("background-color",t.css("background-color"));n.css("vertical-align",t.css("vertical-align"));n.css("border-top-width",t.css("border-top-width"));n.css("border-top-color",t.css("border-top-color"));n.css("border-top-style",t.css("border-top-style"));n.css("border-left-width",t.css("border-left-width"));n.css("border-left-color",t.css("border-left-color"));n.css("border-left-style",t.css("border-left-style"));n.css("border-right-width",t.css("border-right-width"));n.css("border-right-color",t.css("border-right-color"));n.css("border-right-style",t.css("border-right-style"));n.css("border-bottom-width",t.css("border-bottom-width"));n.css("border-bottom-color",t.css("border-bottom-color"));n.css("border-bottom-style",t.css("border-bottom-style"))};n.cssCopy=function(t,i){var r,f,e,u,o,s;for(n.StyleCopy(t,i),r=0;r<i.children("tr").length;r++)for(f=i.children("tr").eq(r),e=t.children("tr").eq(r),u=0;u<f.eq(r).children("th").length;u++)o=f.eq(r).children("th").eq(u),s=e.eq(r).children("th").eq(u),n.StyleCopy(s,o)};n.createClone=function(){n.$clone!=null&&n.$clone.remove();n.$table=$("#Grid");n.$thead=n.$table.children("thead");n.$table.children("thead:empty").remove();n.$table.children("tbody:empty").remove();n.$clone=n.$thead.clone(!0);let r=$._data($(document).get(0),"events"),t={};for(let n in r){let i=$(r).prop(n);for(let n in i){let r=i[n];String(r.selector).indexOf("#")===0&&(t[String(r.selector).slice(1)]=String(r.type))}}let u=n.$clone.find("[id]");for(var i=0;i<u.length;i++){let r=$(u[i]),n=r.attr("id");if(t[n])r.on(t[n],function(){$("#"+n).trigger(t[n])})}n.$clone.appendTo("body");n.view==0?n.$clone.css("display","none"):n.$clone.css("display","table");n.$clone.css("position","fixed");n.$clone.css("border-collapse","collapse");n.$clone.css("top","0px");n.$clone.css("z-index",99);n.$clone.css("left",n.$table.offset().left-$(window).scrollLeft());n.cssCopy(n.$clone,n.$thead)};n.observer=new MutationObserver(function(t){t.some(function(n){return n.target.className==="menu-sort"})||n.createClone()});n.observer.observe(document.getElementById("ViewModeContainer"),{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0});n.createClone();$(window).resize(function(){n.$clone!=null&&n.cssCopy(n.$clone,n.$thead)});$(window).scroll(function(){let t=n.$table.offset();t.top+n.$table.height()<$(window).scrollTop()||t.top>$(window).scrollTop()?n.view==1&&(n.view=0,n.$clone.css("display","none")):t.top<$(window).scrollTop()&&(n.view==0&&(n.createClone(),n.view=1,n.$clone.css("display","table")),n.$clone.css("left",t.left-$(window).scrollLeft()))})}});$(function(){$(document).on("click","#GridCheckAll",function(){$(".grid-check").prop("checked",$("#GridCheckAll").prop("checked"));var n=$p.getData($(this));n.GridUnCheckedItems="";n.GridCheckedItems=""});$(document).on("change",".grid-check",function(){var n=$(this);$("#GridCheckAll").prop("checked")?$p.getData(n).GridUnCheckedItems=$(".grid-check").filter(":not(:checked)").map(function(){return $(this).attr("data-id")}).get().join(","):$p.getData(n).GridCheckedItems=$(".grid-check").filter(":checked").map(function(){return $(this).attr("data-id")}).get().join(",")});$(document).on("change",".grid .select",function(){$p.setData($(this).closest(".grid"))});$(document).on("change",".grid .select-all",function(){$control=$(this);$grid=$(this).closest(".grid");$grid.find(".select").prop("checked",$control.prop("checked"));$p.setData($grid)});$(document).on("click",".grid-row td",function(){var n=$(this).find(".grid-check,.select"),t,r,e,i;if(n.length===0){if(t=$(this).closest(".grid"),!t.hasClass("not-link"))if(t.hasClass("history")){if(!$p.confirmReload())return!1;n=$(this).closest(".grid-row");i=$p.getData(n);i.Ver=n.attr("data-ver");i.Latest=n.attr("data-latest");i.SwitchTargets=$("#SwitchTargets").val();$p.syncSend(n);$p.setCurrentIndex()}else{var f=t.attr("data-func"),u=$(this).closest(".grid-row").attr("data-id"),o=$(this).closest(".grid-row").attr("data-ver"),s=$(this).closest(".grid-row").attr("data-history");f?($p.getData(t)[t.attr("data-name")]=u,$p[f](t)):(r=s?"?ver="+o:"",e=r?"&back=1":"?back=1",$("#EditorDialog").length===1?(i={},i.EditInDialog=!0,url=$("#BaseUrl").val()+u+r,$p.ajax(url,"post",i)):location.href=$("#BaseUrl").val()+u+r+(t.attr("data-value")==="back"?e:""))}}else $p.hoverd(n)||n.trigger("click")})});$(function(){function t(n,t){var r=n.closest(".grid"),i=$p.getData(n);i[n.attr("data-id")]=t;i.Direction=r.attr("data-name");i.TableId=r.attr("id");i.TableSiteId=r.attr("data-id");$p.send(r);delete i[n.attr("id")]}var n;$(document).on("mouseenter","table > thead > tr > th.sortable",function(){clearTimeout(n);$(".menu-sort:visible").length&&$(".menu-sort:visible").hide();$(".ui-multiselect-close:visible").length&&$(".ui-multiselect-close:visible").click();n=setTimeout(function(n){var t=n.attr("data-name");$menuSort=$(".menu-sort[id='GridHeaderMenu__"+t+"']");$menuSort.css("width","");$menuSort.css("position","absolute").css("top",n.position().top+n.outerHeight()).css("left",n.position().left).outerWidth(n.outerWidth()>$menuSort.outerWidth()?n.outerWidth():$menuSort.outerWidth()).show()},700,$(this))});$(document).on("mouseenter","body > thead > tr > th.sortable",function(){clearTimeout(n);$(".menu-sort:visible").length&&$(".menu-sort:visible").hide();$(".ui-multiselect-close:visible").length&&$(".ui-multiselect-close:visible").click();n=setTimeout(function(n){var t=n.attr("data-name");$menuSort=$(".menu-sort[id='GridHeaderMenu__"+t+"']");$menuSort.css("width","");$menuSort.css("position","fixed").css("top",n.position().top+n.outerHeight()).css("left",n.position().left+n.offsetParent().offset().left-window.pageXOffset).outerWidth(n.outerWidth()>$menuSort.outerWidth()?n.outerWidth():$menuSort.outerWidth()).show()},700,$(this))});$(document).on("mouseleave","th.sortable",function(){clearTimeout(n)});$(document).on("mouseleave",".menu-sort",function(){$(".ui-multiselect-menu:visible").length||$(".menu-sort:visible").hide()});$(document).on("click",".menu-sort > li.sort",function(n){t($($(this).parent().attr("data-target")),$(this).attr("data-order-type"));n.stopPropagation()});$(document).on("click",".menu-sort > li.reset",function(n){var r=$(this),i=r.closest(".grid"),t=$p.getData(r);t.Direction=i.attr("data-name");t.TableId=i.attr("id");t.TableSiteId=i.attr("data-id");$('[data-id^="ViewSorters_"]').each(function(){delete t[$(this).attr("data-id")]});$p.send($("#ViewSorters_Reset"));n.stopPropagation()});$(document).on("click","th.sortable",function(n){var i=$(this).find("div");t(i,i.attr("data-order-type"));n.stopPropagation()})});$(function(){var n;$(document).on("mouseenter",".grid-row .grid-title-body, .grid-row .comment",function(){$(this).addClass("focus-inform");n=setTimeout(function(n){n.addClass("height-auto")},700,$(this))});$(document).on("mouseleave",".grid-row .grid-title-body, .grid-row .comment",function(){clearTimeout(n);$(this).removeClass("height-auto").removeClass("focus-inform")})});$p.setGroup=function(n){$("#CurrentMembers").find(".ui-selected").each(function(){var t=$(this),r=t.attr("data-value").split(","),i=n.attr("id");t.attr("data-value",r[0]+","+r[1]+","+(i==="Manager"));t.text(t.text().replace(/\(.*\)/,""));t.text(t.text()+(i==="GeneralUser"?"":"("+$p.display(i)+")"))});$p.setData($("#CurrentMembers"))};$p.setImageLib=function(){$p.paging("#ImageLib")};$p.deleteImage=function(n){var t={};t.Guid=n.attr("data-id");$p.ajax(n.attr("data-action"),n.attr("data-method"),t,n)};$(function(){$(window).on("scroll resize",function(){$("#ImageLib").length===1&&$p.paging("#ImageLib")})});$p.openImportSettingsDialog=function(n){$p.syncSend(n);$("#ImportSettingsDialog").dialog({modal:!0,width:"520px"})};$p.import=function(n){var t=new FormData;t.append("file",$("#Import").prop("files")[0]);t.append("Encoding",$("#Encoding").val());t.append("UpdatableImport",$("#UpdatableImport").prop("checked"));$p.multiUpload($(".main-form").attr("action").replace("_action_",n.attr("data-action")),t,n)};$p.get=function(n,t){function i(n,t){var r=$p.switchTargets(),f=$p.currentIndex(r),u=f+n,i;f!==-1&&u>=0&&u<r.length&&(i=$("#BaseUrl").val()+r[u],t?($p.ajax(i,"post",null,null,!1),n!==0&&history.pushState(null,null,i)):location.href=i)}if(!$p.confirmReload()||$p.outsideDialog(n))return!1;switch(n.attr("id")){case"Reload":i(0,t);break;case"Previous":i(-1,t);break;case"Next":i(1,t)}};$p.new=function(n){location.href=$("#BaseUrl").val()+n.attr("data-to-site-id")+"/new?FromSiteId="+n.attr("data-from-site-id")+"&LinkId="+n.attr("data-id")};$p.copy=function(n){var t=$p.syncSend(n);t===0&&history.pushState(null,null,$("#BaseUrl").val()+$("#Id").val())};$p.search=function(n,t,i){if(i=i!==undefined?i:0,$p.searchWord!==n+i){var r=$("#ApplicationPath").val()+"items/search?text="+escape(n);i>0&&(r+="&offset="+i);t?location.href=r:i!=="-1"&&($p.ajax(r,"get",!1),i===0&&history.pushState(null,null,r));$p.searchWord=n+i}};$(function(){function n(){var n,i=$("[id^=GridHeaderMenu__]:visible"),r,u,t;if(i.length){if(r=i.attr("id").replace("GridHeaderMenu__",""),n=$("body > thead:visible > tr > th.sortable[data-name='"+r+"']"),n.length)$(".menu-sort:visible").length&&$(".menu-sort:visible").hide(),$(".ui-multiselect-close:visible").length&&$(".ui-multiselect-close:visible").click();else{if(n=$("table > thead > tr > th.sortable[data-name='"+r+"']"),!n.length)return;i.css("width","");i.css("position","absolute").css("top",n.position().top+n.outerHeight()).css("left",n.position().left).outerWidth(n.outerWidth()>$menuSort.outerWidth()?n.outerWidth():$menuSort.outerWidth())}u=$(".ui-multiselect-menu:visible");t=$("[id='ViewFiltersOnGridHeader__"+r+"_ms']");u.length&&t.length&&u.css("top",t.offset().top+t.outerHeight()).css("left",t.offset().left)}}$p.apply=function(){$(".menu").menu();$("#EditorTabsContainer:not(.applied),#MailEditorTabsContainer:not(.applied),#ViewTabsContainer:not(.applied),#ColumnAccessControlTabsContainer:not(.applied)").tabs({beforeActivate:function(n,t){t.newPanel.attr("data-action")&&$p.send(t.newPanel)}}).addClass("applied");$(".button-icon:not(.applied)").each(function(){var n=$(this),t=n.attr("data-icon");n.button({icon:t})}).addClass("applied");$(".button-icon.hidden").toggle(!1);$("select[multiple]:not(.applied)").multiselect({selectedList:100,checkAllText:$p.display("CheckAll"),uncheckAllText:$p.display("UncheckAll"),noneSelectedText:"",beforeopen:function(){if($(this).hasClass("search"))return $p.openDropDownSearchDialog($(this)),!1},click:function(){$p.changeMultiSelect($(this))},checkAll:function(){$p.changeMultiSelect($(this))},uncheckAll:function(){$p.changeMultiSelect($(this))}}).addClass("applied");$(".datepicker:not(.applied)").each(function(){var n=$(this);n.datetimepicker({format:n.attr("data-format"),timepicker:n.attr("data-timepicker")==="1",step:10,dayOfWeekStart:1,scrollInput:!1}).addClass("applied")});$.datetimepicker.setLocale("ja");$(".radio:not(.applied)").buttonset().addClass("applied");$(".control-selectable:not(.applied)").selectable({selected:function(n,t){$(this).hasClass("single")&&$(t.selected).addClass("ui-selected").siblings().removeClass("ui-selected").each(function(n,t){$(t).find("*").removeClass("ui-selected")})},stop:function(){$p.setData($(this))}}).addClass("applied");$(".control-slider-ui").each(function(){var n=$("#"+$(this).attr("id").split(",")[0]);$(this).slider({min:parseFloat($(this).attr("data-min")),max:parseFloat($(this).attr("data-max")),step:parseFloat($(this).attr("data-step")),value:parseFloat(n.text()),slide:function(t,i){n.text(i.value);n.attr("data-value",i.value);$p.setData(n)},stop:function(){n.hasClass("auto-postback")&&$p.send(n)}})});$(".control-spinner:not(.applied)").each(function(){var n=$(this);n.spinner({min:n.attr("data-min"),max:n.attr("data-max"),step:n.attr("data-step")}).css("width",function(){return n.attr("data-width")});n.addClass("applied")});$('[class*="enclosed"] .legend:not(.applied)').each(function(){var n=$(this);n.find('[class^="ui-icon ui-icon-triangle-1-"]').length===0&&n.prepend($("<span/>").addClass("ui-icon ui-icon-triangle-1-s"));n.addClass("applied")});$(".control-dropdown:not(.applied)").each(function(){var n=$(this),t=n.find("option:selected").attr("data-class");t!==undefined&&n.addClass(t).addClass("applied")});$(".control-markdown:not(.applied)").each(function(){var n=$(this),t=$('[id="'+this.id+'.viewer"]');t.html($p.markup(n.val()));n.addClass("applied")});$(".markup:not(.applied)").each(function(){var n=$(this);n.html($p.markup(n.html(),!0));n.addClass("applied")});$("#Publish").length===1&&($("a").each(function(){var n=$(this);n.attr("href").indexOf("/binaries/")!==-1&&n.attr("href",n.attr("href").replace("/binaries/","/publishbinaries/"))}),$("img").each(function(){var n=$(this);n.attr("src").indexOf("/binaries/")!==-1&&n.attr("src",n.attr("src").replace("/binaries/","/publishbinaries/"))}));n()};$p.apply()});$p.setKamban=function(){$("#KambanValueField").toggle($("#KambanAggregateType").val()!=="Count");$("#KambanBody .kamban-item").draggable({revert:"invalid",start:function(){$(this).parent().droppable({disabled:!0})}});$("#KambanBody .kamban-container").droppable({hoverClass:"hover",tolerance:"intersect",drop:function(n,t){var i=$p.getData($(".main-form")),r=$("#TableName").val()+"_",u=$(this).attr("data-x"),f=$(this).attr("data-y");i.KambanId=$(t.draggable).attr("data-id");u!==undefined&&(i[r+$("#KambanGroupByX").val()]=u);f!==undefined&&(i[r+$("#KambanGroupByY").val()]=f);$p.send($("#KambanBody"))}})};$(function(){$(document).on("dblclick",".kamban-item",function(){location.href=$("#BaseUrl").val()+$(this).attr("data-id")});$(document).on("click",".kamban-item .ui-icon-pencil",function(){location.href=$("#BaseUrl").val()+$(this).parent().attr("data-id")})});$(function(){$(document).on("keypress",'form[data-enter] input:not([type="button"])',function(n){n.which===13&&$($(this).closest("form").attr("data-enter")).click()});$(document).on("keypress","input",function(n){return n.which!==13});$(document).on("keydown",'[class^="control-"]',function(n){function e(n){return n.hasClass("control-markdown")?($p.toggleEditor(n,!0),$("#"+n.attr("id")).focus(),2):n.is(":hidden")||n.hasClass("control-text")||n.hasClass("control-markup")?0:1}if(n.keyCode===9){var u=$(this).attr("id"),i=!1,r=!0,t=0,f=event.shiftKey?$($('[class^="control-"]').get().reverse()):$('[class^="control-"]');return f.each(function(){if(i){if(t=e($(this)),t===1)return!1;if(t===2)return r=!1,!1}else $(this).attr("id")===u&&(i=!0)}),r}})});$(function(){$(document).on("click",'[class*="enclosed"] .legend',function(){var n=$(this).find(".ui-icon");n.length===1&&($(this).find(".ui-icon-triangle-1-s")[0]?(n.removeClass("ui-icon-triangle-1-s"),n.addClass("ui-icon-triangle-1-e")):(n.removeClass("ui-icon-triangle-1-e"),n.addClass("ui-icon-triangle-1-s")),$(this).parent().children("div").toggle())})});$p.loading=function(n){if(n&&n.prop("tagName")==="BUTTON"){n.prop("disabled",!0).addClass("loading");var t=n.find(".ui-icon");t.attr("data-css",t.prop("class")).prop("class","ui-icon").css("background-image","url("+$("#Logo > a").attr("href")+"images/loading.gif)")}};$p.loaded=function(){$("button.loading").each(function(){var t=$(this),n;t.removeClass("loading").prop("disabled",!1);n=t.find(".ui-icon");n.removeAttr("style").prop("class",n.attr("data-css"))})};$p.generalId=function(n){var t=n.attr("id");return t.indexOf(".")===-1?t:t.substring(0,t.indexOf("."))};$p.showMarkDownViewer=function(n){var t=$('[id="'+n.attr("id")+'.viewer"]');t.length===1&&(t.html($p.markup(n.val())),$p.resizeEditor(n,t),$p.toggleEditor(t,!1),$p.setFormChanged(n))};$p.editMarkdown=function(n){$p.toggleEditor(n,!0);$("[id='"+$p.generalId(n)+"']").focus()};$p.toggleEditor=function(n,t){var i=$p.generalId(n);$('[id="'+i+'.editor"]').length!==0&&(t&&$p.resizeEditor($('[id="'+i+'"]'),$('[id="'+i+'.viewer"]')),$('[id="'+i+'.viewer"]').toggle(!t),$('[id="'+i+'.editor"]').toggle(!t),$('[id="'+i+'"]').toggle(t))};$p.resizeEditor=function(n,t){t.height()<=300?n.height(t.height()):n.height(300)};$p.markup=function(n,t){function f(n){var t=$("<pre/>");return n.split(/\r\n|\r|\n/).forEach(function(n){n!==""&&t.append($("<span/>").append(n));t.append($("<br/>"))}),t[0].outerHTML}function e(n){return n.replace(/(!\[[^\]]+\]\(.+?\))/gi,function(n){return'<a href="'+r(n)+'" target="_blank"><img src="'+r(n)+'" alt="'+u(n)+'" /><\/a>'}).replace(/(\[[^\]]+\]\(.+?\))/gi,function(n){return'<a href="'+r(n)+'" target="_blank">'+u(n)+"<\/a>"}).replace(/(\b(https?|notes|ftp):\/\/((?!\*|"|<|>|\||&gt;|&lt;).)+"?)/gi,function(n){return n.slice(-1)!='"'?'<a href="'+n+'" target="_blank">'+n+"<\/a>":n})}function o(n){return n.replace(/(\[[^\]]+\]\(\B\\\\((?!:|\*|"|<|>|\||&gt;|&lt;).)+\\((?!:|\*|"|<|>|\||&gt;|&lt;).)+\))/gi,function(n){return'<a href="file://'+r(n)+'">'+u(n)+"<\/a>"}).replace(/(\B\\\\((?!:|\*|"|<|>|\||&gt;|&lt;).)+\\((?!:|\*|"|<|>|\||&gt;|&lt;).)+"?)/gi,function(n){return n.slice(-1)!='"'?'<a href="file://'+n+'">'+n+"<\/a>":n})}function s(n){return $("<div/>").text(n).html()}function r(n){var t=n.match(/\(.+?\)/gi)[0];return t.substring(1,t.length-1)}function u(n){var t=n.match(/\[[^\]]+\]/i)[0];return t.substring(1,t.length-1)}var i=n;return t||(i=s(i)),i=o(i),i.indexOf("[md]")===0?'<div class="md">'+marked(i.substring(4))+"<\/div>":e(f(i))};$p.insertText=function(n,t){var i=n.get(0);i.focus();var u=i.value,r=i.selectionStart,f=r+t.length;i.value=u.substr(0,r)+t+u.substr(r);i.setSelectionRange(f,f);$p.setData(n);n.is(":visible")||$p.showMarkDownViewer(n)};$p.selectImage=function(n){$('[id="'+n+'.upload-image-file"]').click()};$p.uploadImage=function(n,t){var r=$(".main-form").attr("action").replace("_action_","binaries/uploadimage"),i=new FormData;i.append("ControlId",n);i.append("file",t);$p.multiUpload(r,i)};$(function(){$(document).on("blur",".control-markdown:not(.error)",function(){$p.showMarkDownViewer($(this))});$(document).on("paste",".upload-image",function(n){var i,t,r;if(n.originalEvent.clipboardData!==undefined&&n.originalEvent.clipboardData.types.indexOf("text/plain")===-1)for(i=n.originalEvent.clipboardData.items,t=0;t<i.length;t++)r=i[t],r.type.indexOf("image")!==-1&&$p.uploadImage(this.id,r.getAsFile())});$(document).on("change",".upload-image-file",function(){this.files.length===1&&($p.uploadImage($(this).attr("data-id"),this.files[0]),this.value="")})});$(function(){$(document).on("mouseenter","#NavigationMenu > li",function(){var n=$(this).find(":first-child");n.addClass("hover");$("#"+n.attr("data-id")).show()});$(document).on("mouseleave","#NavigationMenu > li",function(){var n=$(this).find(":first-child");n.removeClass("hover");$("#"+n.attr("data-id")).hide()})});$p.setMessage=function(n,t){var u=JSON.parse(t),i=n!==undefined?n.split("_")[0]==="row"?$('[data-id="'+n.split("_")[1]+'"]'):$(n):$(".message-dialog:visible"),r;i.prop("tagName")==="TR"?(r=$($("<tr/>").addClass("message-row").append($("<td/>").attr("colspan",i.find("td").length).append($("<span/>").addClass("body").addClass(u.Css).text(u.Text)))),i.after(r),$("html,body").animate({scrollTop:i.offset().top-50})):(r=$($("<div/>").append($("<span/>").addClass("body").addClass(u.Css).text(u.Text))),i.length===0?($("#Message").hasClass("message")&&r.append($("<span/>").addClass("ui-icon ui-icon-close close")),$("#Message").append(r)):i.append(r))};$p.setErrorMessage=function(n,t){var i={};i.Css="alert-error";i.Text=$p.display(n);$p.clearMessage();$p.setMessage(t,JSON.stringify(i))};$p.clearMessage=function(){$('[class*="message"]').html("")};$(function(){$(document).on("click",".message .close",function(){$(this).parent().remove()});var n=$("#MessageData");n.length===1&&$p.setMessage("#Message",n.val())});$p.moveTargets=function(n){$p.send(n);$p.openDialog(n,".main-form")};$p.move=function(n){var t=$p.syncSend(n)};$p.changeMultiSelect=function(n){$p.setData(n);n.hasClass("auto-postback")&&!n.hasClass("no-postback")&&$p.send(n);n.removeClass("no-postback")};$p.setMultiSelectData=function(n){$p.getData(n)[n.attr("id")]=JSON.stringify($('[name="multiselect_'+n.attr("id")+'"]').filter(function(){return $(this).prop("checked")}).map(function(){return $(this).val()}).toArray())};$p.currentIndex=function(n){return n.indexOf($("#Id").val())};$p.switchTargets=function(){var n=$("#SwitchTargets");return n.length===1?n.val().split(","):[]};$p.setSwitchTargets=function(){var n=$("#SwitchTargets");n.length===1&&(n.appendTo("body"),$p.setCurrentIndex())};$p.setCurrentIndex=function(){var n=$p.switchTargets(),t;n.length>1?(t=$p.currentIndex(n),$("#CurrentIndex").text(t+1+"/"+n.length)):($("#Previous").hide(),$("#CurrentIndex").hide(),$("#Next").hide())};$p.back=function(){var n=$("#BackUrl");n.length===1&&(location.href=n.val())};$(function(){$(window).on("popstate",function(n){n.originalEvent.currentTarget.location.pathname!==$("#BaseUrl").val()+$("#Id").val()&&$p.ajax(n.originalEvent.currentTarget.location,"post")});$p.setSwitchTargets();var n=$("#BackUrl");n.length===1&&n.appendTo("body")});$p.openOutgoingMailDialog=function(n){var i=0,t;$("#OutgoingMails_Title").length===0&&(t=$p.getData($("#OutgoingMailsForm")),t.Controller=$("#Controller").val(),t.Id=$("#Id").val(),i=$p.syncSend(n,"OutgoingMailsForm"));i===0&&$("#OutgoingMailDialog").dialog({modal:!0,width:"90%",height:"auto",dialogClass:"outgoing-mail"})};$p.openOutgoingMailReplyDialog=function(n){$p.getData($("#OutgoingMailsForm")).OutgoingMails_OutgoingMailId=n.attr("data-id");var t=$p.syncSend(n,"OutgoingMailsForm");t===0&&$("#OutgoingMailDialog").dialog({modal:!0,width:"90%",height:"auto",dialogClass:"outgoing-mail"})};$p.sendMail=function(n){var t=$p.getData($("#OutgoingMailForm"));t.Ver=$("._Ver")[0].innerHTML;t.Controller=$("#Controller").val();t.Id=$("#Id").val();$p.send(n)};$p.initOutgoingMailDialog=function(){var n=$("#"+$p.tableName()+"_Body").val();n=n!==undefined?n+"\n\n":"";$("#OutgoingMails_Reply").val()!=="1"&&($("#OutgoingMails_Title").val($("#HeaderTitle").text()),$("#OutgoingMails_Body").val(n+$("#OutgoingMails_Location").val()));$p.addMailAddress($("#OutgoingMails_To"),$("#To").val());$p.addMailAddress($("#OutgoingMails_Cc"),$("#Cc").val());$p.addMailAddress($("#OutgoingMails_Bcc"),$("#Bcc").val())};$p.addMailAddress=function(n,t){var i=t!==undefined?t:$("#OutgoingMails_MailAddresses").find(".ui-selected").map(function(){return unescape($(this).text())}).get().join(";");i&&i.split(";").forEach(function(t){t&&$p.addBasket(n,t)});$p.setData(n)};$(function(){function n(){$("#MailEditorTabsContainer").tabs("option","active",0)}$(document).on("click","#OutgoingMails_AddTo",function(){$p.addMailAddress($("#OutgoingMails_To"));n()});$(document).on("click","#OutgoingMails_AddCc",function(){$p.addMailAddress($("#OutgoingMails_Cc"));n()});$(document).on("click","#OutgoingMails_AddBcc",function(){$p.addMailAddress($("#OutgoingMails_Bcc"));n()})});$p.setPermissionEvents=function(){$p.setPaging("SourcePermissions")};$p.setPermissions=function(n){$p.setData($("#CurrentPermissions"));$p.setData($("#SourcePermissions"));$p.setData($("#SearchPermissionElements"));$p.send(n)};$p.openPermissionsDialog=function(n){$p.data.PermissionsForm={};var t=$p.syncSend(n);t===0&&$("#PermissionsDialog").dialog({modal:!0,width:"700px",appendTo:"#Editor"})};$p.changePermissions=function(n){$p.setData($("#CurrentPermissions"));var t=$p.getData(n),i=$p.getData($(".main-form"));t.CurrentPermissions=i.CurrentPermissions;t.CurrentPermissionsAll=i.CurrentPermissionsAll;$p.send(n)};$p.setPermissionForCreating=function(n){$p.setData($("#CurrentPermissionForCreating"));$p.setData($("#SourcePermissionForCreating"));$p.send(n)};$p.openPermissionForCreatingDialog=function(n){$p.data.PermissionForCreatingForm={};var t=$p.syncSend(n);t===0&&$("#PermissionForCreatingDialog").dialog({modal:!0,width:"700px",appendTo:"#Editor"})};$p.changePermissionForCreating=function(n){$p.setData($("#CurrentPermissionForCreating"));var t=$p.getData(n),i=$p.getData($(".main-form"));t.CurrentPermissionForCreating=i.CurrentPermissionForCreating;t.CurrentPermissionForCreatingAll=i.CurrentPermissionForCreatingAll;$p.send(n)};$p.hoverd=function(n){function i(n){var t=n.offset().left,i=n.offset().top,r=t+n.outerWidth(),u=i+n.outerHeight();return $p.mouseX>=t&&$p.mouseX<=r&&$p.mouseY>=i&&$p.mouseY<=u?!0:!1}var t;return n.each(function(){if(i($(this)))return t=$(this),!1}),t};$(window).mousemove(function(n){$p.mouseX=n.pageX;$p.mouseY=n.pageY});$p.saveScroll=function(){$p.scrollX=document.documentElement.scrollLeft||document.body.scrollLeft;$p.scrollY=document.documentElement.scrollTop||document.body.scrollTop};$p.loadScroll=function(){window.scroll($p.scrollX,$p.scrollY)};$p.clearScroll=function(){$p.scrollX=0;$p.scrollY=0};$p.paging=function(n){var t=$(n),i=$(n+"Offset");t.length&&$(window).scrollTop()+$(window).height()>=t.offset().top+t.height()&&i.val()!=="-1"&&($p.setData(i),i.val("-1"),$p.send(t))};$p.setPaging=function(n){var t=document.getElementById(n+"Wrapper"),i=t.offsetHeight;$(t).scroll(function(){var r=t.scrollHeight,f=t.scrollTop,e=i+f,u=$("#"+n+"Offset");(r-e)/r<=0&&u.val()!=="-1"&&($p.send($("#"+n)),u.val("-1"))})};$(function(){$(window).on("scroll resize",function(){$p.paging("#Grid")})});$(function(){$(document).on("mouseenter","#Search",function(){$(this).prop("disabled",!1)});$(document).on("change","#Search",function(){$p.search($(this).val(),$(this).hasClass("redirect"))});$(document).on("keydown","#Search",function(n){n.which===13&&$p.search($(this).val(),$(this).hasClass("redirect"))});if($("#SearchResults").length===1){$(window).on("scroll resize",function(){var n=$("#SearchResults");n.length&&$(window).scrollTop()+$(window).height()>=n.offset().top+n.height()&&$("#SearchOffset").val()!=="-1"&&$p.search($("#Search").val(),!1,$("#SearchOffset").val())});$(document).on("click","#SearchResults .result",function(){location.href=$(this).attr("data-href")})}});$p.openChangePasswordDialog=function(){var n=$p.getData($("#ChangePasswordForm"));n.Users_LoginId=$("#Users_LoginId").val();n.Users_OldPassword=$("#Users_Password").val();n.ReturnUrl=$("#ReturnUrl").val();$("#ChangePasswordDialog").dialog({modal:!0,width:"420px"})};$p.changePasswordAtLogin=function(n){var t=$p.getData($("#ChangePasswordForm"));t.Users_LoginId=$("#Users_LoginId").val();t.Users_Password=$("#Users_Password").val();$p.send(n)};$p.addSelected=function(n,t){n.closest(".container-selectable").find(".ui-selected").appendTo(t);$p.setData(t);$p.send(n)};$p.deleteSelected=function(n){var t=n.closest(".container-selectable").find(".control-selectable");t.find(".ui-selected").remove();$p.setData(n);$p.send(n)};$p.openSeparateSettingsDialog=function(n){var t=$p.syncSend(n);t===0&&$("#SeparateSettingsDialog").dialog({modal:!0,width:"700px",appendTo:".main-form"})};$p.separateSettings=function(){function t(t,i){$("#SeparateSettings .item").each(function(n){i>=n+1?$(this).hasClass("hidden")&&$(this).removeClass("hidden"):$(this).hasClass("hidden")||$(this).addClass("hidden")});n(t,0)}function n(n,t){var u=!0,f=i(n,t),e=$("#SourceWorkValue"),r=parseFloat(e.attr("data-value"));return r>=f?r=Math.round((r-f)*100)/100:(n.val(Math.round((r-i(n,0))*100)/100),u=!1,r=0),e.text(r+$("#WorkValueUnit").val()),$p.getData(n).SourceWorkValue=r,u}function i(n,t){var i=$('[id*="SeparateWorkValue_"]:visible');return $.map(i,function(i){return n.attr("id")!==i.id?parseFloat($(i).val()):parseFloat(t)}).reduce(function(n,t){return n+t})}$(function(){$("#SeparateSettings").on("spin","#SeparateNumber",function(n,i){t($(this),i.value)});$("#SeparateSettings").on("change","#SeparateNumber",function(){t($(this),$(this).val())});$("#SeparateSettings").on("spin",'[id*="SeparateWorkValue_"]',function(t,i){return n($(this),i.value)});$("#SeparateSettings").on("change",'[id*="SeparateWorkValue_"]',function(){n($(this),$(this).val())})})};$p.openDeleteSiteDialog=function(){$("#DeleteSiteDialog input").val("");$("#DeleteSiteDialog").dialog({modal:!0,width:"420px",height:"auto",appendTo:".main-form"})};$p.tableName=function(){return $("#TableName").val()};$p.methodType=function(){return $("#MethodType").val()};$p.setSiteMenu=function(){$(".nav-sites.sortable").sortable({delay:150,stop:function(n,t){var r=t.item.attr("data-value"),u=$p.hoverd($('.nav-site:not([data-value="'+r+'"])')),i;u&&(t.item.hide(),i=$p.getData($(".main-form")),i.SiteId=r,i.DestinationId=u.attr("data-value"),$p.send($("#MoveSiteMenu")))},update:function(){$p.getData($(this)).Data=$p.toJson($(".nav-sites.sortable li"));$p.send($("#SortSiteMenu"))}})};$p.openLinkDialog=function(){$("#LinkDialog").dialog({modal:!0,width:"420px",appendTo:".main-form"})};$p.uploadSiteImage=function(n){var t=new FormData;t.append("file",$("#SiteImage").prop("files")[0]);$p.multiUpload($(".main-form").attr("action").replace("_action_",n.attr("data-action")),t,n)};$p.openSiteSettingsDialog=function(n,t,i){var r=$p.syncSend(n);r===0&&$(t).dialog({modal:!0,width:i!==undefined?i:"90%",height:"auto",appendTo:"#Editor"})};$p.openGridColumnDialog=function(n){$p.data.GridColumnForm={};$p.openSiteSettingsDialog(n,"#GridColumnDialog")};$p.setGridColumn=function(n){$p.setData($("#UseGridDesign"));$p.setData($("#GridDesign"));$p.send(n)};$p.openFilterColumnDialog=function(n){$p.data.FilterColumnForm={};$p.openSiteSettingsDialog(n,"#FilterColumnDialog")};$p.openAggregationDetailsDialog=function(n){$p.data.AggregationDetailsForm={};$p.openSiteSettingsDialog(n,"#AggregationDetailsDialog","420px")};$p.setAggregationDetails=function(n){$p.setData($("#AggregationType"));$p.setData($("#AggregationTarget"));$p.setData($("#SelectedAggregation"));$p.send(n)};$p.openEditorColumnDialog=function(n){$p.data.EditorColumnForm={};$p.openSiteSettingsDialog(n,"#EditorColumnDialog")};$p.resetEditorColumn=function(n){$p.syncSend(n);var t=$p.getData(n);$('#EditorColumnForm [class^="control-"]').each(function(n,i){$p.setData($(i),t)})};$p.openSummaryDialog=function(n){$p.data.SummaryForm={};$p.openSiteSettingsDialog(n,"#SummaryDialog")};$p.setSummary=function(n){$p.setData($("#EditSummary"),$p.getData(n));$p.send(n)};$p.openFormulaDialog=function(n){$p.data.FormulaForm={};$p.openSiteSettingsDialog(n,"#FormulaDialog")};$p.openViewDialog=function(n){$p.data.ViewForm={};$p.openSiteSettingsDialog(n,"#ViewDialog")};$p.openNotificationDialog=function(n){$p.data.NotificationForm={};$p.openSiteSettingsDialog(n,"#NotificationDialog")};$p.setNotification=function(n){$p.setData($("#EditNotification"),$p.getData(n));$p.send(n)};$p.openReminderDialog=function(n){$p.data.ReminderForm={};$p.openSiteSettingsDialog(n,"#ReminderDialog")};$p.setReminder=function(n){$p.setData($("#EditReminder"),$p.getData(n));$p.send(n)};$p.openExportDialog=function(n){$p.data.ExportForm={};$p.openSiteSettingsDialog(n,"#ExportDialog")};$p.setExport=function(n){$p.setData($("#EditExport"),$p.getData(n));$p.send(n)};$p.openExportColumnsDialog=function(n){$p.data.ExportColumnsForm={};$p.openSiteSettingsDialog(n,"#ExportColumnsDialog","420px")};$p.setExportColumn=function(n){$p.setData($("#EditExport"),$p.getData(n));$p.send(n)};$p.openScriptDialog=function(n){$p.data.ScriptForm={};$p.openSiteSettingsDialog(n,"#ScriptDialog")};$p.setScript=function(n){$p.setData($("#EditScript"),$p.getData(n));$p.send(n)};$p.openStyleDialog=function(n){$p.data.StyleForm={};$p.openSiteSettingsDialog(n,"#StyleDialog")};$p.setStyle=function(n){$p.setData($("#EditStyle"),$p.getData(n));$p.send(n)};$p.addSummary=function(n){$p.setData($("#SummarySiteId"));$p.setData($("#SummaryDestinationColumn"));$p.setData($("#SummaryLinkColumn"));$p.setData($("#SummaryType"));$p.setData($("#SummarySourceColumn"));$p.send(n)};$p.openRelatingColumnDialog=function(n){$p.data.RelatingColumnForm={};$p.openSiteSettingsDialog(n,"#RelatingColumnDialog")};$p.setRelatingColumn=function(n){$p.setData($("#EditRelatingColumns"),$p.getData(n));$p.send(n)};$(function(){$(document).on("change","#UseGridDesign",function(){$("#GridDesignField").toggle($(this).prop("checked"))});$(document).on("change","#ControlType",function(){var n=$(this).val()==="Spinner";$("#MinField").toggle(n);$("#MaxField").toggle(n);$("#StepField").toggle(n)});$(document).on("change","#FormatSelector",function(){var n=$(this);switch(n.val()){case"\t":$("#FormatField").toggle(!0);$("#Format").val("");break;default:$("#FormatField").toggle(!1);$("#Format").val(n.val())}$p.setData($("#Format"))});$(document).on("change","#NotificationType",function(){$("#NotificationTokenField").toggle($("#NotificationTokenEnableList").val().split(",").indexOf($("#NotificationType").val())!==-1)});$(document).on("click","#SummarySettings .grid-row button",function(){var n=$($(this).attr("data-selector"));$p.getData(n)[n.attr("id")+"Id"]=$(this).attr("data-id");$p.send(n)});$(document).on("change","#SummaryDestinationCondition",function(){$("#SummarySetZeroWhenOutOfConditionField").toggle($(this).val()!=="")});$(document).on("change","#FormulaCondition",function(){$("#FormulaOutOfConditionField").toggle($(this).val()!=="")});$(document).on("click","#AddViewSorter",function(){var t=$("#ViewSorterSelector option:selected"),i=$("#ViewSorterOrderTypes option:selected").val(),n="";switch(i){case"asc":n="("+$p.display("OrderAsc")+")";break;case"desc":n="("+$p.display("OrderDesc")+")"}$p.addBasket($("#ViewSorters"),t.text()+n,t.val()+"&"+i)});$(document).on("change","#StyleAll",function(){$("#StyleAll").prop("checked")?$(".output-destination-style").addClass("hidden").find("input").prop("checked",!1):$(".output-destination-style").removeClass("hidden").find("input")});$(document).on("change","#ScriptAll",function(){$("#ScriptAll").prop("checked")?$(".output-destination-script").addClass("hidden").find("input").prop("checked",!1):$(".output-destination-script").removeClass("hidden").find("input")});$(document).on("change","#DateFilterSetMode",function(){$("#DateFilterSetMode").val()==="1"?$("#FilterColumnSettingField").removeClass("hidden"):$("#FilterColumnSettingField").addClass("hidden")})});$(function(){$(document).on("change",".control-dropdown",function(){var n=$(this).find("option:selected").attr("data-class");$(this).removeClass(function(n,t){return(t.match(/\bstatus-\S+/g)||[]).join(" ")});n!==undefined&&$(this).addClass(n)})});$(function(){$(document).on("submit",function(){return!1})});$p.templates=function(n){$p.send(n,"MainForm")};$p.setTemplate=function(){var n=".template-selectable .control-selectable";$("#TemplateTabsContainer:not(.applied)").tabs({beforeActivate:function(t,i){$p.setTemplateData(i.newPanel.find(n))}}).addClass("applied");$(n).selectable({selected:function(n,t){$(t.selected).addClass("ui-selected").siblings().removeClass("ui-selected").each(function(n,t){$(t).find("*").removeClass("ui-selected")})},stop:function(){$p.setTemplateData($(this))}})};$p.setTemplateData=function(n){var t=n.find("li.ui-selected"),i=t.length===1;$p.setData(n);$p.send(n);$("#OpenSiteTitleDialog").removeClass("hidden").toggle(i);$("#SiteTitle").val(i?t[0].innerText:"");$("#TemplateId").val(i?t[0].getAttribute("data-value"):"")};$p.setTemplateViewer=function(){$(".template-tab-container").tabs().addClass("applied")};$p.openSiteTitleDialog=function(){$("#SiteTitleDialog").dialog({modal:!0,width:"370px",appendTo:"#Application"})};$p.drawTimeSeries=function(){function g(t){var r=d3.svg.area().x(function(t){return $p.dateDiff("d",new Date(t.Day),f)*y+u+n}).y0(function(){return e(0)}).y1(function(n){return e(n.Y)}),o=i.append("g").attr("class","surface");o.append("path").attr("d",r(t)).attr("fill",nt())}function nt(){var n=Math.floor(Math.random()*50+180);return"#"+s(n)+s(n)+s(n)}function s(n){return(n+Math.floor(Math.random()*10-5)).toString(16)}var r;if($("#TimeSeriesValueField").toggle($("#TimeSeriesAggregateType").val()!=="Count"),r=$("#TimeSeries"),r.length===1){r.empty();var h=JSON.parse($("#TimeSeriesJson").val()),o=h.Indexes,t=h.Elements;if(t.length===0){r.hide();return}r.show();var i=d3.select("#TimeSeries"),n=40,u=130,c=50,p=parseInt(i.style("width")),l=parseInt(i.style("height")),a=p-u-n,w=l-c-n,f=new Date(d3.min(t,function(n){return n.Day})),v=new Date(d3.max(t,function(n){return n.Day})),y=(a-n)/$p.dateDiff("d",v,f),b=d3.time.scale().domain([f,v]).range([n,a]),e=d3.scale.linear().domain([d3.max(t,function(n){return n.Y}),0]).range([n,w]).nice(),k=d3.svg.axis().scale(b).tickFormat(d3.time.format("%m/%d")).ticks(10),d=d3.svg.axis().scale(e).orient("left");i.append("g").attr("class","axis").attr("transform","translate("+u+", "+(l-c)+")").call(k).selectAll("text").attr("x",-20).attr("y",20).style("text-anchor","start");i.append("g").attr("class","axis").attr("transform","translate("+u+", 0)").call(d).selectAll("text").attr("x",-20);o.forEach(function(n){var i=t.filter(function(t){return t.Index===n.Id});g(i)});o.forEach(function(r){var h=t.filter(function(n){return n.Index===r.Id}),s,c;h.length!==0&&(s=h[h.length-1],c=i.append("g"),c.append("text").attr("class","index").attr("x",$p.dateDiff("d",new Date(s.Day),f)*y+u+n-10).attr("y",e(s.Y-s.Value/2)).attr("text-anchor","end").attr("dominant-baseline","middle").text(o.filter(function(n){return n.Id===s.Index})[0].Text))})}};$p.returnOriginalUser=function(n){$p.ajax(n,"post",null,$("#SwitchUserInfo a"))};$(function(){$.validator.addMethod("c_num",function(n,t){return this.optional(t)||/^(-)?(¥|\\|\$)?[\d,.]+$/.test(n)});$.validator.addMethod("c_min_num",function(n,t,i){return this.optional(t)||parseFloat(n.replace(/[¥,]/g,""))>=parseFloat(i)});$.validator.addMethod("c_max_num",function(n,t,i){return this.optional(t)||parseFloat(n.replace(/[¥,]/g,""))<=parseFloat(i)});$p.setValidationError=function(n){n.find(".ui-tabs li").each(function(){$(".control-markdown.error").each(function(){$p.toggleEditor($(this),!0)});var n=$("#"+$(this).attr("aria-controls")).find("input.error:first:not(.search)");n.length===1&&($(this).closest(".ui-tabs").tabs("option","active",$(this).index()),n.focus())})};$p.applyValidator=function(){$.extend($.validator.messages,{required:$p.display("ValidateRequired"),c_num:$p.display("ValidateNumber"),c_min_num:$p.display("ValidateMinNumber"),c_max_num:$p.display("ValidateMaxNumber"),date:$p.display("ValidateDate"),email:$p.display("ValidateEmail"),equalTo:$p.display("ValidateEqualTo"),maxlength:$p.display("ValidateMaxLength")});$("form").each(function(){$(this).validate({ignore:""})});$('[data-validate-required="1"]').each(function(){$(this).rules("add",{required:!0})});$('[data-validate-number="1"]').each(function(){$(this).rules("add",{c_num:!0})});$("[data-validate-min-number]").each(function(){$(this).rules("add",{c_min_num:$(this).attr("data-validate-min-number")})});$("[data-validate-max-number]").each(function(){$(this).rules("add",{c_max_num:$(this).attr("data-validate-max-number")})});$('[data-validate-date="1"]').each(function(){$(this).rules("add",{date:!0})});$('[data-validate-email="1"]').each(function(){$(this).rules("add",{email:!0})});$("[data-validate-equal-to]").each(function(){$(this).rules("add",{equalTo:$(this).attr("data-validate-equal-to")})});$("[data-validate-maxlength]").each(function(){$(this).rules("add",{maxlength:$(this).attr("data-validate-maxlength")})})};$p.applyValidator()});$p.openVideo=function(n){navigator.mediaDevices.getUserMedia({video:!0,audio:!1}).then(function(t){$("#VideoTarget").val(n);$("#VideoDialog").dialog({modal:!0,width:"680px",appendTo:"#Application",close:function(){$p.videoTracks.forEach(function(n){n.stop()})}});$p.video=document.getElementById("Video");$p.video.src=window.URL.createObjectURL(t);$p.videoTracks=t.getVideoTracks();$p.video.play()}).catch(function(){$p.setErrorMessage("CanNotConnectCamera");return})};$p.toShoot=function(n){var t=document.getElementById("Canvas"),i=$p.video.offsetWidth,r=$p.video.offsetHeight;t.setAttribute("width",i);t.setAttribute("height",r);t.getContext("2d").drawImage($p.video,0,0,i,r);t.toBlob(function(n){$p.uploadImage($("#VideoTarget").val(),n)},"image/jpeg",.95);$p.closeDialog(n)};$p.viewMode=function(n){var t=$(".main-form").attr("action").replace("_action_",n.attr("data-action").toLowerCase());$p.ajax(t,"post",$p.getData(n),n);history.pushState(null,null,t)};$(function(){$("body").css({visibility:"visible"})});$(document).ready(function(){var u=$("#TriggerRelatingColumns").val(),n,t,r,i;if(u!==undefined){n=JSON.parse(u);for(t in n){r="";for(i in n[t].Columns)r!==""&&n[t].Columns[i]!==null&&n[t].ColumnsLinkedClass[n[t].Columns[i]]!==null&&$p.applyRelatingColumn(r,n[t].Columns[i],n[t].ColumnsLinkedClass[n[t].Columns[i]]),r=n[t].Columns[i]}}});$p.applyRelatingColumn=function(n,t,i){$(document).ready(function(){var u=$("#TableName").val(),f;u!==undefined&&((f=$("#"+u+"_"+t).attr("data-id"),f===undefined||isNaN(f))||(r(u,f,i),$("#"+u+"_"+n).change(function(){r(u,f,i)})))});var r=function(i,r){var e=$("#"+i+"_"+n+" option:selected").val(),f=$("#"+i+"_"+t+" option:selected").val();$("#"+i+"_"+t).prop("disabled",!0);$("#"+i+"_"+t).empty();$("#"+i+"_"+t).append($("<option>").val(f).prop("id","Temporary_"+t).prop("selected",!0));$("#"+i+"_"+t).append($("<option>").val(""));u(i,r,null,e,f,!1)},u=function(n,r,f,e,o,s){var w,c,v,b,p,h,k;$("#"+n+"_"+t).attr("parent-data-class",i);$("#"+n+"_"+t).attr("parent-data-id",e===""?"-1":e);var l=0,a=0,y=0;if(f!==null)for(l=f.Response.Offset,a=f.Response.PageSize,y=f.Response.TotalCount,w=a+l<y?a:y-l,c=0;c<w;c++)v=f.Response.Data[c].ResultId,v==undefined&&(v=f.Response.Data[c].IssueId),b=f.Response.Data[c].ItemTitle,p=!1,v==o&&(s=!0,p=!0),$("#"+n+"_"+t).append($("<option>").val(v).prop("selected",p).text(b));f===null||l+a<y?(h={},h.ApiKey="",h.Offset=l+a,h.View={},h.View.ColumnFilterHash={},h.View.ColumnFilterHash[i]='["'+e+'"]',h.View.ColumnSorterHash={},h.View.ColumnSorterHash.ItemTitle=0,k=$("#ApplicationPath").val()+"api/items/"+escape(+r)+"/get",$.ajax({type:"POST",url:k,dataType:"json",data:JSON.stringify(h),contentType:"application/json",scriptCharset:"utf-8",async:!1}).done(function(t){t.StatusCode==200?u(n,r,t,e,o,s):alert("Error\r\nStatusCode:"+t.StatusCode)}).fail(function(i,r,u){alert(r+"\r\n"+u);$("#"+n+"_"+t).prop("disabled",!1)})):(o>0&&o!==undefined&&!s&&($("#"+n+"_"+t).val(""),$("#"+n+"_"+t).trigger("change")),$("#Temporary_"+t).remove(),$("#"+n+"_"+t).prop("disabled",!1))}};$p.moveColumns=function(n,t,i,r){return formId===undefined?!1:$p.moveColumnsById(n,t+"Columns",t+"SourceColumns",i,r!==undefined&&r===!0?t+"Join":undefined)};$p.moveColumnsById=function(n,t,i,r,u){var e,h,y,b,nt,p,k,d;if($p.outsideDialog(n))return alert("outsideDialog"),!1;if(formId===undefined||n.attr("id")===undefined||n.attr("id")===null)return!1;$form=$("#"+formId);var v=n.attr("id"),c=0,w=r!==undefined&&r===!0;if(v.indexOf("MoveUp")===0&&(c=1),v.indexOf("MoveDown")===0&&(c=2),v.indexOf("ToDisable")===0&&(c=3),v.indexOf("ToEnable")===0&&(c=4),c===0)return!1;var tt=$p.getData($form),a=[],l=[],o=[],g=[],s=[],f=0;if(j=0,e=null,h=$("#"+t+" li").map(function(){if($(this).hasClass("ui-selected"))return $(this).attr("data-value")}),$("#"+t+" li").each(function(n,t){l.push($(t).attr("data-value"))}),i!==""&&(y=$("#"+i+" li").map(function(){if($(this).hasClass("ui-selected"))return $(this).attr("data-value")}),$("#"+i+" li").each(function(n,t){g.push($(t).attr("data-value"))})),s=[].concat(g),c===1||c===2){for(c===1&&(l=l.reverse()),f=0;f<l.length;f++)h.get().indexOf(l[f])>=0?a.push(l[f]):(o.push(l[f]),a.length>0&&(o=o.concat(a),a=[]));a.length>0&&(o=o.concat(a),a=[]);c===1&&(l=l.reverse(),o=o.reverse())}else if(c===3){if($("#"+i+" li").each(function(){$(this).hasClass("ui-selected")&&$(this).removeClass("ui-selected")}),$("#"+t+"NessesaryColumns")&&(b=$("#"+t+"NessesaryColumns").val(),b!==undefined))for(nt=JSON.parse(b),f=0;f<h.length;f++)if(nt.indexOf(h[f])>=0)return alert($("#"+t+"NessesaryMessage").val().replace("COLUMNNAME",$("#"+t+" li[data-value='"+h[f]+"'").html())),!1;for(o=[].concat(l),p=s.length,f=0;f<h.length;f++)if(p=s.length,o.splice(o.indexOf(h[f]),1),(u===undefined||$("#"+u+" option:selected").val()!==""&&h[f].indexOf($("#"+u+" option:selected").val()+",")>=0||$("#"+u+" option:selected").val()===""&&h[f].indexOf(",")<0)&&!w){if($("#"+t+" li[data-value='"+h[f]+"']").attr("data-order")!==undefined)for(j=0;j<s.length;j++){if(e=$("#"+t+" li[data-value='"+s[j]+"']"),$(e).get(0)||(e=$("#"+i+" li[data-value='"+s[j]+"']")),$(e).attr("data-order")===undefined)break;if(parseInt($("#"+t+" li[data-value='"+h[f]+"']").attr("data-order"),10)<parseInt($(e).attr("data-order"),10)){p=j;break}}s.splice(p,0,h[f])}}else if(c===4)for($("#"+t+" li").each(function(){$(this).hasClass("ui-selected")&&$(this).removeClass("ui-selected")}),o=[].concat(l),f=0;f<y.length;f++)o.push(y[f]),w||s.splice(s.indexOf(y[f]),1);for(k="",d="",e=null,f=0;f<o.length;f++)e=$("#"+t+" li[data-value='"+o[f]+"']"),$(e).get(0)||(e=$("#"+i+" li[data-value='"+o[f]+"']")),$(e).get(0)&&(k+=$(e).get(0).outerHTML);for(f=0;f<s.length;f++)e=$("#"+t+" li[data-value='"+s[f]+"']"),$(e).get(0)||(e=$("#"+i+" li[data-value='"+s[f]+"']")),$(e).get(0)&&(d+=$(e).get(0).outerHTML);$("#"+t).html(k);i!==""&&($("#"+i).html(d),w&&$("#"+i+" li").removeClass("ui-selected"))};$p.uploadTenantImage=function(n){var t=new FormData;t.append("file",$("#TenantImage").prop("files")[0]);$p.multiUpload($(".main-form").attr("action").replace("_action_",n.attr("data-action")),t,n)};